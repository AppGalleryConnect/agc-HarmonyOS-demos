"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CredentialParser=void 0;var error_1=require("../error/error"),error_message_1=require("../error/error-message"),credential_type_1=require("./credential-type"),clientid_credential_1=require("./clientid-credential"),utils_1=require("../utils/utils"),fs_1=__importDefault(require("fs")),CredentialParser=function(){function o(){}return o.toCredential=function(e,r){var t;if(e)o.checkJsonFile(e),t=fs_1.default.readFileSync(e,"utf8");else{e=process.env[o.AGC_CONFIG_ENV_VAR];if(null==e)throw new error_1.AGCError(error_message_1.ErrorCodeConstant.CREDENTIAL_ENV_NOT_SET);o.checkJsonFile(e),t=fs_1.default.readFileSync(e,"utf8")}var i=JSON.parse(t);if(null==i)throw new error_1.AGCError(error_message_1.ErrorCodeConstant.CREDENTIAL_PARSER);switch(i.type){case credential_type_1.CredentialType.TEAM_CLIENT_ID:var n=r?r():i.client_secret;return new clientid_credential_1.ClientIdCredential("","",i.developer_id,i.type,i.client_id,n,i.configuration_version);case credential_type_1.CredentialType.PROJECT_CLIENT_ID:return n=r?r():i.client_secret,new clientid_credential_1.ClientIdCredential(i.project_id,i.region,i.developer_id,i.type,i.client_id,n,i.configuration_version);default:throw new error_1.AGCError(error_message_1.ErrorCodeConstant.CREDENTIAL_PARSER)}},o.checkJsonFile=function(e){try{(0,utils_1.voilidatePath)(e)}catch(e){throw e instanceof error_1.AGCError?new error_1.AGCError(error_message_1.ErrorCodeConstant.AGC_CLIENT_CREDENTIAL,void 0,void 0,e.getMessage()):new error_1.AGCError(error_message_1.ErrorCodeConstant.AGC_CLIENT_CREDENTIAL)}},o.AGC_CONFIG_ENV_VAR="AGC_CONFIG",o}();exports.CredentialParser=CredentialParser;